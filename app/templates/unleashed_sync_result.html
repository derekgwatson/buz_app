{% extends "layout.html" %}

{% block title %}Unleashed Sync Results{% endblock %}

{% block head %}
    <style>
      body { font-family: system-ui, sans-serif; margin: 24px; }
      .ok { color: #0a7f36; }
      .warn { color: #b54708; }
      .err { color: #b42318; }
      code { background: #f6f8fa; padding: 2px 6px; border-radius: 4px; }
      ul { margin-top: 6px; }
    </style>
{% endblock %}

{% block content %}
    <h2>Unleashed Sync</h2>

    {% if error %}
      <p class="err"><strong>Failed:</strong> {{ error }}</p>
    {% else %}
      <p class="ok"><strong>Success.</strong></p>
    {% endif %}

    {% set adds_ = adds|default([]) %}
    {% set dels_ = deletes|default([]) %}
    {% set files_ = files|default([]) %}

    <p>
      Adds: <strong>{{ adds_|length }}</strong>,
      Deletes: <strong>{{ dels_|length }}</strong>,
      Pricing rows: <strong>{{ pricing_count|default(0) }}</strong>
    </p>

    {% if adds_|length %}
      <details>
        <summary>Show first 50 add candidates</summary>
        <ul>
          {% for a in adds_[:50] %}
            <li><code>{{ a }}</code></li>
          {% endfor %}
        </ul>
      </details>
    {% endif %}

    {% if dels_|length %}
      <details>
        <summary>Show first 50 delete candidates</summary>
        <ul>
          {% for d in dels_[:50] %}
            <li><code>{{ d }}</code></li>
          {% endfor %}
        </ul>
      </details>
    {% endif %}

    {% if files_|length %}
      <h3>Downloads</h3>
      <ul>
        {% for f in files_ %}
          <li>
            {{ f.label }}:
            <a href="{{ url_for('main_routes.download_file', filename=f.filename) }}" target="_blank" rel="noopener">
              {{ f.filename }}
            </a>
          </li>
        {% endfor %}
      </ul>
      <p class="warn">Note: files are saved to your <code>UPLOAD_OUTPUT_DIR</code> and available via the link(s) above.</p>
    {% else %}
      <p>No files were generated.</p>
      {% if (adds_|length or dels_|length or pricing_count|default(0)) and not error %}
        <p class="warn">Heads up: counts show changes, but no files were emitted. Check logs for any skips (e.g., missing Buz Code on delete).</p>
      {% endif %}
    {% endif %}

    <p><a href="{{ url_for('main_routes.homepage') }}">Back to home</a></p>

{% endblock %}
