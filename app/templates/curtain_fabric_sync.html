{% extends "layout.html" %}

{% block title %}Buz <-> Unleashed Pricing Update{% endblock %}

{% block content %}

<h1>Curtain Fabric Sync</h1>

{% if message %}
    <p><strong>{{ message }}</strong></p>

    <h2>Summary</h2>
    <ul>
        <li>New items: {{ summary.new_items }}</li>
        <li>Updated items: {{ summary.updated_items }}</li>
        <li>Removed items: {{ summary.removed_items }}</li>
        <li>Pricing changes:
            <ul>
            {% for group, count in summary.pricing_changes.items() %}
                <li>{{ group }}: {{ count }}</li>
            {% endfor %}
            </ul>
        </li>
    </ul>

    <h2>Files</h2>
    <ul>
        <li><a href="/{{ items_file }}">Download Items Upload</a></li>
        <li><a href="/{{ pricing_file }}">Download Pricing Upload</a></li>
    </ul>

    <h2>Log Output</h2>
    <pre>{{ log }}</pre>
{% else %}

    <form method="post" class="container mt-4">
      <fieldset class="border p-4 mb-4">
        <legend class="h5 mb-3">Column Titles from Google Sheet</legend>

        {% for key, value in column_titles.items() %}
          <div class="mb-3">
            <label for="columns_{{ key }}" class="form-label">{{ key.replace('_', ' ').title() }}:</label>
            <input type="text" class="form-control" name="columns[{{ key }}]" id="columns_{{ key }}" value="{{ value }}">
          </div>
        {% endfor %}

        <div class="mt-4">
          <button type="submit" class="btn btn-primary">Run Sync</button>
          <p class="form-text mt-2">This will generate new upload files for Buz using the latest fabric data from Google Sheets.</p>
        </div>
      </fieldset>
    </form>

{% endif %}

{% endblock %}
